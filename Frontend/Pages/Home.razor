@page "/"
@layout CustomerLayout
@inject NavigationManager NavigationManager
@inject Frontend.Services.IAuthService AuthService

<PageTitle>Home - Car Rental System</PageTitle>

<!-- Hero Section -->
<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6">
    <MudPaper Elevation="0" Class="pa-8 text-center animate-fade-in" 
              Style="background: linear-gradient(135deg, #0d9488 0%, #0f766e 50%, #115e59 100%); color: white; border-radius: 20px; position: relative; overflow: hidden;">
        <!-- Decorative Pattern -->
        <div style="position: absolute; inset: 0; opacity: 0.1; background-image: url('data:image/svg+xml,%3Csvg width=&quot;60&quot; height=&quot;60&quot; viewBox=&quot;0 0 60 60&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cg fill=&quot;none&quot; fill-rule=&quot;evenodd&quot;%3E%3Cg fill=&quot;%23ffffff&quot; fill-opacity=&quot;1&quot;%3E%3Cpath d=&quot;M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z&quot;/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
        
        <MudStack Spacing="4" Style="position: relative; z-index: 1;">
            <MudIcon Icon="@Icons.Material.Filled.DirectionsCar" Class="mb-2" Style="font-size: 5rem; opacity: 0.9;" />
            <MudText Typo="Typo.h2" Style="font-weight: 800; letter-spacing: -0.02em;">Welcome to Car Rental</MudText>
            <MudText Typo="Typo.h5" Style="opacity: 0.9; font-weight: 400; max-width: 600px; margin: 0 auto;">
                Discover the perfect vehicle for your journey with our premium fleet
            </MudText>
            <MudStack Row="true" Justify="Justify.Center" Spacing="3" Class="mt-4">
                @if (isAuthenticated)
                {
                    <MudButton Variant="Variant.Filled" 
                               Size="Size.Large" 
                               StartIcon="@Icons.Material.Filled.DirectionsCar" 
                               OnClick="NavigateToVehicles"
                               Style="background: white; color: #0d9488; font-weight: 600; padding: 0.875rem 2rem;">
                        Browse Vehicles
                    </MudButton>
                    <MudButton Variant="Variant.Outlined" 
                               Size="Size.Large" 
                               StartIcon="@Icons.Material.Filled.EventNote" 
                               OnClick="NavigateToRentals"
                               Style="border-color: white; color: white; font-weight: 600; padding: 0.875rem 2rem;">
                        My Rentals
                    </MudButton>
                }
                else
                {
                    <MudButton Variant="Variant.Filled" 
                               Size="Size.Large" 
                               StartIcon="@Icons.Material.Filled.DirectionsCar" 
                               OnClick="NavigateToVehicles"
                               Style="background: white; color: #0d9488; font-weight: 600; padding: 0.875rem 2rem;">
                        Browse Vehicles
                    </MudButton>
                    <MudButton Variant="Variant.Outlined" 
                               Size="Size.Large" 
                               StartIcon="@Icons.Material.Filled.Login" 
                               OnClick="NavigateToLogin"
                               Style="border-color: white; color: white; font-weight: 600; padding: 0.875rem 2rem;">
                        Sign In
                    </MudButton>
                }
            </MudStack>
        </MudStack>
    </MudPaper>
</MudContainer>

<!-- Stats Section -->
<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6">
    <MudGrid Spacing="4">
        <MudItem xs="6" md="3">
            <MudPaper Elevation="1" Class="pa-4 text-center" Style="border-radius: 16px;">
                <MudText Typo="Typo.h3" Color="Color.Primary" Style="font-weight: 800;">50+</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Vehicles Available</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" md="3">
            <MudPaper Elevation="1" Class="pa-4 text-center" Style="border-radius: 16px;">
                <MudText Typo="Typo.h3" Color="Color.Primary" Style="font-weight: 800;">1000+</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Happy Customers</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" md="3">
            <MudPaper Elevation="1" Class="pa-4 text-center" Style="border-radius: 16px;">
                <MudText Typo="Typo.h3" Color="Color.Primary" Style="font-weight: 800;">24/7</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Support Available</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" md="3">
            <MudPaper Elevation="1" Class="pa-4 text-center" Style="border-radius: 16px;">
                <MudText Typo="Typo.h3" Color="Color.Primary" Style="font-weight: 800;">4.9</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">Customer Rating</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

<!-- Features Section -->
<MudContainer MaxWidth="MaxWidth.Large" Class="mt-8 mb-6">
    <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-2" Style="font-weight: 700;">Why Choose Us?</MudText>
    <MudText Typo="Typo.body1" Align="Align.Center" Color="Color.Secondary" Class="mb-6" Style="max-width: 600px; margin: 0 auto;">
        Experience hassle-free car rental with premium service and modern vehicles
    </MudText>
    <MudGrid Spacing="4">
        <MudItem xs="12" md="4">
            <MudCard Elevation="2" Class="hover-card" Style="height: 100%; border-radius: 16px;">
                <MudCardContent Class="text-center pa-6">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                        <MudIcon Icon="@Icons.Material.Filled.FlashOn" Style="font-size: 2.5rem; color: white;" />
                    </div>
                    <MudText Typo="Typo.h5" GutterBottom="true" Style="font-weight: 700;">Quick Booking</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        Book your vehicle in just a few clicks with our streamlined reservation system
                    </MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudCard Elevation="2" Class="hover-card" Style="height: 100%; border-radius: 16px;">
                <MudCardContent Class="text-center pa-6">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981 0%, #34d399 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                        <MudIcon Icon="@Icons.Material.Filled.VerifiedUser" Style="font-size: 2.5rem; color: white;" />
                    </div>
                    <MudText Typo="Typo.h5" GutterBottom="true" Style="font-weight: 700;">Secure & Safe</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        All our vehicles are regularly maintained, fully insured, and sanitized
                    </MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudCard Elevation="2" Class="hover-card" Style="height: 100%; border-radius: 16px;">
                <MudCardContent Class="text-center pa-6">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                        <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Style="font-size: 2.5rem; color: white;" />
                    </div>
                    <MudText Typo="Typo.h5" GutterBottom="true" Style="font-weight: 700;">Best Prices</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        Competitive rates with flexible pricing, seasonal offers, and loyalty rewards
                    </MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
</MudContainer>

<!-- Vehicle Categories -->
<MudContainer MaxWidth="MaxWidth.Large" Class="mb-8">
    <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-2" Style="font-weight: 700;">Browse by Category</MudText>
    <MudText Typo="Typo.body1" Align="Align.Center" Color="Color.Secondary" Class="mb-6">
        Find the perfect vehicle type for your needs
    </MudText>
    <MudGrid Spacing="3">
        <MudItem xs="6" md="3">
            <MudPaper Elevation="2" Class="pa-5 text-center hover-card" Style="border-radius: 16px; cursor: pointer;" @onclick='() => NavigateToCategory("Economy")'>
                <div style="width: 60px; height: 60px; background: #e0f2fe; border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <MudIcon Icon="@Icons.Material.Filled.DirectionsCar" Style="font-size: 2rem; color: #0284c7;" />
                </div>
                <MudText Typo="Typo.subtitle1" Style="font-weight: 600;">Economy</MudText>
                <MudText Typo="Typo.caption" Color="Color.Secondary">From $29/day</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" md="3">
            <MudPaper Elevation="2" Class="pa-5 text-center hover-card" Style="border-radius: 16px; cursor: pointer;" @onclick='() => NavigateToCategory("SUV")'>
                <div style="width: 60px; height: 60px; background: #dcfce7; border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <MudIcon Icon="@Icons.Material.Filled.LocalShipping" Style="font-size: 2rem; color: #16a34a;" />
                </div>
                <MudText Typo="Typo.subtitle1" Style="font-weight: 600;">SUV</MudText>
                <MudText Typo="Typo.caption" Color="Color.Secondary">From $49/day</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" md="3">
            <MudPaper Elevation="2" Class="pa-5 text-center hover-card" Style="border-radius: 16px; cursor: pointer;" @onclick='() => NavigateToCategory("Luxury")'>
                <div style="width: 60px; height: 60px; background: #fef3c7; border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <MudIcon Icon="@Icons.Material.Filled.Diamond" Style="font-size: 2rem; color: #d97706;" />
                </div>
                <MudText Typo="Typo.subtitle1" Style="font-weight: 600;">Luxury</MudText>
                <MudText Typo="Typo.caption" Color="Color.Secondary">From $99/day</MudText>
            </MudPaper>
        </MudItem>
        <MudItem xs="6" md="3">
            <MudPaper Elevation="2" Class="pa-5 text-center hover-card" Style="border-radius: 16px; cursor: pointer;" @onclick='() => NavigateToCategory("Sports")'>
                <div style="width: 60px; height: 60px; background: #fee2e2; border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <MudIcon Icon="@Icons.Material.Filled.Speed" Style="font-size: 2rem; color: #dc2626;" />
                </div>
                <MudText Typo="Typo.subtitle1" Style="font-weight: 600;">Sports</MudText>
                <MudText Typo="Typo.caption" Color="Color.Secondary">From $149/day</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

<!-- Call to Action -->
@if (!isAuthenticated)
{
    <MudContainer MaxWidth="MaxWidth.Large" Class="mb-8">
        <MudPaper Elevation="3" Class="pa-8 text-center" 
                  Style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; border-radius: 20px;">
            <MudIcon Icon="@Icons.Material.Filled.Celebration" Style="font-size: 3rem; opacity: 0.9; margin-bottom: 1rem;" />
            <MudText Typo="Typo.h4" Style="font-weight: 700; margin-bottom: 0.5rem;">Ready to Hit the Road?</MudText>
            <MudText Typo="Typo.body1" Style="opacity: 0.85; max-width: 500px; margin: 0 auto 1.5rem;">
                Join thousands of satisfied customers who trust us with their travel needs
            </MudText>
            <MudStack Row="true" Justify="Justify.Center" Spacing="3">
                <MudButton Variant="Variant.Filled" 
                           Size="Size.Large" 
                           StartIcon="@Icons.Material.Filled.PersonAdd" 
                           OnClick="NavigateToRegister"
                           Style="background: #0d9488; color: white; font-weight: 600; padding: 0.875rem 2rem;">
                    Create Account
                </MudButton>
                <MudButton Variant="Variant.Outlined" 
                           Size="Size.Large" 
                           StartIcon="@Icons.Material.Filled.Login" 
                           OnClick="NavigateToLogin"
                           Style="border-color: rgba(255,255,255,0.5); color: white; font-weight: 600; padding: 0.875rem 2rem;">
                    Sign In
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudContainer>
}

@code {
    private bool isAuthenticated = false;
    private string? username;

    protected override async Task OnInitializedAsync()
    {
        await LoadUserState();
    }

    private async Task LoadUserState()
    {
        try
        {
            isAuthenticated = await AuthService.IsAuthenticatedAsync();
            if (isAuthenticated)
            {
                username = await AuthService.GetUsernameAsync();
                var role = await AuthService.GetRoleAsync();
                
                // Redirect admin/employee to admin dashboard
                if (role == "Admin" || role == "Employee")
                {
                    NavigationManager.NavigateTo("/admin", true);
                }
            }
        }
        catch (Exception)
        {
            isAuthenticated = false;
        }
    }

    private void NavigateToVehicles() => NavigationManager.NavigateTo("/vehicles/browse");
    private void NavigateToRentals() => NavigationManager.NavigateTo("/my-rentals");
    private void NavigateToLogin() => NavigationManager.NavigateTo("/login");
    private void NavigateToRegister() => NavigationManager.NavigateTo("/register");
    private void NavigateToCategory(string category) => NavigationManager.NavigateTo($"/vehicles/browse?category={category}");
}
